<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Electro Asistan</title>
<style>
  body { font-family: Arial, sans-serif; background:#f7f8fa; margin:0; padding:0; }
  #chat { display:flex; flex-direction:column; height:100vh; padding:10px; }
  #messages { flex:1; overflow-y:auto; padding:10px; background:white;
    border-radius:10px; margin-bottom:10px; font-size:14px; }
  #input-area { display:flex; gap:10px; }
  input { flex:1; padding:10px; border-radius:8px; border:1px solid #ccc; }
  button { background:#0d6efd; color:white; border:none; padding:10px 15px;
    border-radius:8px; cursor:pointer; }
</style>
</head>
<body>
<div id="chat">
  <div id="messages">
    <b>ðŸ¤– Electro Asistan:</b> Merhaba! Size nasÄ±l yardÄ±mcÄ± olabilirim?
  </div>
  <div id="input-area">
    <input type="text" id="userInput" placeholder="Bir soru veya Ã¼rÃ¼n isteÄŸi yazÄ±n..." />
    <button onclick="sendMessage()">GÃ¶nder</button>
  </div>
</div>

<script>
const apiURL = "https://electro-api-swart.vercel.app/api/products";
const gptURL = "https://electro-api-swart.vercel.app/api/askgpt";

async function sendMessage() {
  const input = document.getElementById('userInput');
  const msgBox = document.getElementById('messages');
  const text = input.value.trim();
  if (!text) return;

  msgBox.innerHTML += `<div><b>ðŸ‘¤ Sen:</b> ${text}</div>`;
  input.value = "";

  try {
    // ÃœrÃ¼n arama
    const res = await fetch(apiURL);
    const data = await res.json();

    const terms = text.toLowerCase().split(" ").filter(t => t.length > 1);
    const found = data.filter(p => {
      const haystack = `${p.name} ${p.category} ${p.brand}`.toLowerCase();
      const numberMatch = text.match(/\d+/);
      if (numberMatch) {
        const num = numberMatch[0];
        if (!haystack.includes(num)) return false;
      }
      return terms.every(term => haystack.includes(term));
    });

    if (found.length > 0) {
      msgBox.innerHTML += `<div><b>ðŸ¤– Asistan:</b> ${found.length} Ã¼rÃ¼n buldum:</div>`;
      found.slice(0, 3).forEach(p => {
        msgBox.innerHTML += `
          <div style="margin:8px 0; padding:8px; border:1px solid #ddd; border-radius:8px;">
            <b>${p.name}</b><br>${p.price} ${p.currency}<br>
            <a href="${p.url}" target="_blank">ÃœrÃ¼nÃ¼ GÃ¶r</a>
          </div>`;
      });
    } else {
      // GPT entegrasyonu
      console.log("GPT'ye gÃ¶nderilen veri:", text);

      const gptRes = await fetch(gptURL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ question: text }),
});

      const gptData = await gptRes.json();
      msgBox.innerHTML += `<div><b>ðŸ¤– Asistan:</b> ${gptData.answer}</div>`;
    }

    msgBox.scrollTop = msgBox.scrollHeight;

  } catch (err) {
    msgBox.innerHTML += `<div><b>ðŸ¤– Asistan:</b> ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu (${err.message}).</div>`;
  }
}
</script>
</body>
</html>

